<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teste de Rastreamento de Cores</title>
    <style>
        #container {
            position: relative;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scaleX(-1); /* Inverte horizontalmente para todas as câmeras */
        }
        
        #p5video {
            position: relative;
            transition: transform 0.2s ease-in-out;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
       
        #myCanvas {
            position: absolute;
            width: 640px;
            height: 480px;
            transform: scaleX(-1);
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #zoom {
            position: absolute;
            width: 640px;
            height: 480px;
            overflow: hidden;
        }
        
        #botoes {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        #traseira button {
            transform: scaleX(-1); /* Inverte o texto do botão horizontalmente */
        }

    </style>
</head>
<body>
    <div id="container">
        <div id="zoom">
            <video id="p5video" autoplay playsinline></video>
        </div>
        <canvas id="myCanvas" width="640" height="480"></canvas>
    </div>
    <div id="botoes">
        
        <div id="traseira">
          <button onclick="toggleCamera()">Toggle Camera</button>
        </div>
       
        <button onclick="zoomIn()">Zoom In</button>
        <button onclick="zoomOut()">Zoom Out</button>
        
    </div>

    <script src="p5-min.js"></script>
    <script src="p5.2.js"></script>
    <script src="tracking-min.js"></script>
    <script>
        var tracker;
        var rhiRed, ghiRed, bhiRed;
        var rloRed, gloRed, bloRed;
        var rhiBlue, ghiBlue, bhiBlue;
        var rloBlue, gloBlue, bloBlue;
        var videoElement;
       
        var facingMode = "environment"; // Inicia com a câmera traseira

        function setTargetRed(r, g, b, range) {
            range = range || 100;
            rhiRed = r + range, rloRed = r - range;
            ghiRed = g + range, gloRed = g - range;
            bhiRed = b + range, bloRed = b - range;
        }

        function setTargetBlue(r, g, b, range) {
            range = range || 100;
            rhiBlue = r + range, rloBlue = r - range;
            ghiBlue = g + range, gloBlue = g - range;
            bhiBlue = b + range, bloBlue = b - range;
        }

        function setup() {
            if (videoElement) {
                videoElement.srcObject.getTracks().forEach(track => track.stop());
            }
            var constraints = {
                audio: false,
                video: {
                    facingMode: facingMode,
                    width: 640,
                    height: 480
                }
            };
            navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {
                    videoElement = document.getElementById('p5video');
                    videoElement.srcObject = stream;
                    videoElement.onloadedmetadata = function() {
                        videoElement.play();
                        if (facingMode === "user") {
                            videoElement.style.transform = "scaleX(-1)"; // Aplica a transformação para a câmera frontal
                        } else {
                            videoElement.style.transform = "none"; // Reseta a transformação para a câmera traseira
                        }
                    };
                })
                .catch(function(err) {
                    console.log("Erro ao acessar a câmera: " + err);
                });

            setTargetRed(255, 0, 0); // Define a cor vermelha
            setTargetBlue(0, 0, 255); // Define a cor azul

            // Restante do seu código de configuração...
        }

        let zoomLevel = 1.0; // Nível de zoom inicial
        const zoomStep = 0.1; // Incremento/decremento do zoom
        
        function toggleCamera() {
            if (facingMode === "environment") {
                facingMode = "user";
            } else {
                facingMode = "environment";
            }
            setup();
        }

        function zoomIn() {
            zoomLevel += zoomStep;
            applyZoom();
        } 

        function zoomOut() {
            if (zoomLevel > zoomStep) {
                zoomLevel -= zoomStep;
                applyZoom();
            }
        } 

        function applyZoom() {
            var scaleFactor = zoomLevel;
            var video = document.getElementById('p5video');
            var container = document.getElementById('container');

            var newWidth = video.videoWidth * scaleFactor;
            var newHeight = video.videoHeight * scaleFactor;

            if (newWidth <= container.offsetWidth && newHeight <= container.offsetHeight) {
                video.style.width = newWidth + 'px';
                video.style.height = newHeight + 'px';
            }
        }

        setup(); // Inicia o setup quando a página é carregada
    </script>
</body>
</html>
